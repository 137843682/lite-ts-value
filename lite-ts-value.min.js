!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(()=>(()=>{"use strict";var e=[function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ValueServiceBase=void 0,i(n(1),t),i(n(2),t);var r=n(3);Object.defineProperty(t,"ValueServiceBase",{enumerable:!0,get:function(){return r.ValueServiceBase}}),i(n(4),t)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueHandelrBase=void 0;t.ValueHandelrBase=class{setNext(e){return this.next=e}}},function(e,t){var n,o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function u(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ValueServiceBase=t.RelationOperator=void 0,function(e){e.eq="=",e.ge=">=",e.gt=">",e.le="<=",e.lt="<",e.nowDiff="now-diff",e.mod="%"}(n=t.RelationOperator||(t.RelationOperator={}));t.ValueServiceBase=class{constructor(e,t){this.nowTime=e,this.ownValue=t}checkConditions(e){return o(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.length))return!0;const t=yield this.nowTime.unix();for(const i of e){const e=i.map((e=>o(this,void 0,void 0,(function*(){let o=yield this.getCount(e.valueType),i=e.count,r=e.op;switch(e.op.includes(n.nowDiff)?(o=t-o,r=e.op.replace(n.nowDiff,"")):e.op.includes(n.mod)&&(o%=Math.floor(e.count/100),r=e.op.replace(n.mod,""),i%=100),r){case n.ge:return o>=i;case n.gt:return o>i;case n.le:return o<=i;case n.lt:return o<i;default:return o==i}})))),r=(yield Promise.all(e)).every((e=>e));if(r)return r}return!1}))}checkEnough(e){return o(this,void 0,void 0,(function*(){for(const t of e){if((yield this.getCount(t.valueType))+t.count<0)return!1}return!0}))}getCount(e){var t,n,i;return o(this,void 0,void 0,(function*(){if(e=Number(e),isNaN(e))return 0;const o=yield this.ownValue,r={count:null!==(t=o[e])&&void 0!==t?t:0,valueType:e};return yield null===(i=null===(n=this.getGetCountHandler(this))||void 0===n?void 0:n.handle)||void 0===i?void 0:i.call(n,r),r.count}))}update(e){var t,n;return o(this,void 0,void 0,(function*(){if(null==e?void 0:e.length)for(const o of e)o.valueType=Number(o.valueType),isNaN(o.valueType)||(o.count=Number(o.count),isNaN(o.count)||(yield null===(n=null===(t=this.getUpdateHandler(this))||void 0===t?void 0:t.handle)||void 0===n?void 0:n.call(t,Object.assign({},o))))}))}}},function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function u(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCountHandler=void 0;const i=n(2);class r extends i.ValueHandelrBase{constructor(e){super(),this.ownValue=e}handle(e){var t,n;return o(this,void 0,void 0,(function*(){const o=yield this.ownValue;null!==(t=o[n=e.valueType])&&void 0!==t||(o[n]=0),o[e.valueType]+=e.count}))}}t.UpdateCountHandler=r}],t={};var n=function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(0);return n})()));